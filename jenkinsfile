pipeline {
      agent any
      tools {
          maven 'M2_HOME'
      }

      stages {
      stage('Checkout code')
      {

          steps {
              git branch: 'master', url: 'https://github.com/onsnasri/country-service.git'
          }
      }
      stage('Compile, test code, package in war file and store it in maven repo')
      {
          steps {
              sh 'mvn clean install'
          }

          post{
              success {
                 junit allowEmptyResults: true, testResults: '.** /target/sunfire-reports/*.xml'
              }
          }
       }
      stage('SonarQube Analysis')
      {
          steps{
              withSonarQubeEnv(installationName: 'MySonarQubeServer', credentialsId: 'sonarqubePWD'){
              sh "mvn sonar:sonar -Dsonar.projectkey=country-service -Dsonar.host.url=http://localhost:9000 -Dsonar.login=$SONAR_AUTH_TOKEN"
}
}
}
}
}
